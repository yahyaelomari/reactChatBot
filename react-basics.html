<!DOCTYPE html>
<html>
  <head>
    <title>React Basics</title>
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">


      function ChatInput({chatMessages,setChatMessages}){

        const [chatInput,setChatInput] = React.useState('');

        function watchInput(event){
          setChatInput(event.target.value);
        }

        function sendMessage(){
        //CASE 1:
          //   const newChatMessages = [
          //     ...chatMessages,
          //     {
          //       "message":chatInput,
          //       "sender":"human",
          //       "id":crypto.randomUUID()
          //     }
          //   ]
          //
          // setChatMessages(newChatMessages);
          //
          // const response = Chatbot.getResponse(chatInput);
          //
          // setChatMessages([
          //   ...newChatMessages,
          //   {
          //     "message":response,
          //     "sender":"robot",
          //     "id":crypto.randomUUID()
          //   }
          // ]);

          const newHumanMessage = {
                "message":chatInput,
                "sender":"human",
                "id":crypto.randomUUID()
          }

          const response = Chatbot.getResponse(chatInput);


          const newRobotResponse = {
            "message":response,
            "sender":"robot",
            "id":crypto.randomUUID()
          }

          setChatMessages([
                  ...chatMessages,
                  newHumanMessage,
                  newRobotResponse
          ]);

          setChatInput('');
        }

        return(
          <>
              <input onChange={watchInput} value={chatInput} placeholder="write question here!"  size="30"/>
              <button onClick={sendMessage}> send </button>
          </>
        );
      }

      function MessageBox({message,sender}){

        return(
          <div>
            {sender == "robot" && <img src="images/robot.png" width="20" />}
            {message}
            {sender == "human" && <img src="images/user.png" width="20" />}
          </div>
        );
      }


      function GenerateMessages({chatMessages}){

              return (
                      <>
                        {chatMessages.map((chatMessage) => {
                        return (<MessageBox message={chatMessage.message} sender={chatMessage.sender} key={chatMessage.id}/> )
                        })}

                     </>
              );
      }

      function App(){
        const [chatMessages,setChatMessages] = React.useState(
                [{"message":"heelo me human","sender":"human","id":"id1"}, {"message":"heelo me robot","sender":"robot","id":"id2"}]
        )
        return (
          <>
          <ChatInput
          chatMessages={chatMessages}
          setChatMessages={setChatMessages}
          />
          <GenerateMessages
          chatMessages={chatMessages}
          />

          </>
        );
      }





      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>